<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Компоненты — UWebcomponents</title>
    <link rel="stylesheet" href="style.css" />
    <script src="signa.min.js"></script>
    <link rel="stylesheet" href="default.css">
    <script src="highlight.min.js"></script>

    <script>hljs.highlightAll();</script>
    <script src="src/popup.js"></script>
    <link rel="stylesheet" href="src/popup.css" />

    <script src="src/navdrawer.js"></script>
    <link rel="stylesheet" href="src/navdrawer.css" />

    <style>

    </style>
</head>

<body>
    <aside class="sidebar">
        <div class="logo">Signa</div>
        <div class="nav-section-title">Введение</div>
        <a class="nav-link" href="#intro">О библиотеке</a>
        <a class="nav-link" href="#features">Возможности</a>
        <a class="nav-link" href="#quick-start">Быстрый старт</a>


        <div class="nav-section-title">Основы</div>
        <a class="nav-link" href="#components">Компоненты</a>
        <a class="nav-link" href="#props">Props</a>
        <a class="nav-link" href="#slots">Slots</a>
        <a class="nav-link" href="#store">Store</a>
        <a class="nav-link" href="#eventbus">EventBus</a>
        <a class="nav-link" href="#di">Provide / Inject</a>
        <a class="nav-link" href="#routing">Роутинг</a>
        <div>
            <div class="nav-section-title">Компоненты</div>
            <a class="nav-link" href="#popup-window">Popup window</a>
            <a class="nav-link" href="#nav-drawer">Navigation drawer</a>
        </div>
    </aside>

    <main class="content">


        <h1 id="intro">Web Components Framework</h1>
        <p>
            <strong>Signa</strong> — лёгкий фреймворк для создания реактивных Web Components
            на базе сигналов и микро-шаблонизатора.
        </p>

        <h2 id="features">Возможности</h2>
        <ul>
            <li>Создание Web Components через простой API</li>
            <li>HTML-шаблоны на базе uhtml</li>
            <li>Реактивность через @preact/signals-core</li>
            <li>Store для разделяемого состояния</li>
            <li>EventBus для общения компонентов</li>
            <li>Provide / Inject (DI)</li>
            <li>Клиентский роутинг</li>
            <li>Размер: ~20kb min / ~8kb gzip</li>
        </ul>
        <h2 id="quick-start">Быстрый старт</h2>

        <h3>IIFE в браузере</h3>
        <pre><code class="language-html"><script type="text/plain">
<script src="signa.min.js"></script>
</script></code></pre>

        <h3>Пример компонента</h3>
        <pre><code class="language-javascript"><script type="text/plain">
defComponent('my-counter', (ctx) => {
    const count = ctx.signal(0);

    return () => ctx.html`
        <div>
            <p>Count: ${count.value}</p>
            <button onclick=${() => count.value++}>Increment</button>
        </div>
    `;
});
</script></code></pre>

        <h2 id="components">Компоненты</h2>
        <p>Компоненты объявляются через defComponent.</p>

        <pre><code class="language-javascript"><script type="text/plain">
defComponent('my-component', (ctx) => {
    const {
        signal,
        effect,
        computed,
        html,
        prop,
        slot,
        store,
        inject,
        provide,
        eventBus,
        createRouter,
    } = ctx;

    const title = prop('title');
    const count = signal(0);
    const doubleCount = computed(() => count.value * 2);

    effect(() => {
        console.log('Count changed:', count.value);
    });

    return () => html`
        <h1>${title.value}</h1>
        <p>Count: ${count.value}</p>
        <p>Double: ${doubleCount.value}</p>
    `;
});
</script></code></pre>

        <h2 id="props">Props</h2>
        <pre><code class="language-javascript"><script type="text/plain">
const count = prop('count', { type: Number, default: 0 });

const myProp = prop( 'myPropName', { // this name in html data-myPropName or direct pass .myPropName="{$somValue}"
    type: String | Number | Boolean | Array | Object | Function
    default: 'default value',
});
//or
const shortProp = prop('myProp');

return html`<div>${myProp.value}</div>`
//in component pass signal as prop value to child
defComponent('my-component', ({ html, prop }) => {
    //Caution all signal prop are read only
    const count = prop('count');

    return html `${count.value}`
})

//in parent
defComponent('my-component', ({ html, prop }) => {
    const count = signal(0);
    return html`<my-component .count="${count}"></my-component>`
})

// as function
const onPressButton = prop('onPressButon');

return html`<my-component .onPressButton="${() => console.log('onPress')}"></my-component>`
</script></code></pre>

        <pre><code class="language-html"><script type="text/plain">
<my-component data-count="10"></my-component>
<!--In html use as initional value from php render-->
<my-component data-count="10"></my-component>
<my-component data-array="[1,2,3]"></my-component>
<--Also can use KebabCase notation, example data-my-prop is convert to myProp in defComponent-->
</script></code></pre>

        <h2 id="slots">Slots</h2>
        <pre><code class="language-html"><script type="text/plain">
<my-component>
    <div data-slot="header">Header</div>
    <div>Default slot</div>
</my-component>
</script></code></pre>

        <pre><code class="language-javascript"><script type="text/plain">
const header = slot('header');
const content = slot.default;
</script></code></pre>

        <h2 id="store">Store</h2>
        <pre><code class="language-javascript"><script type="text/plain">
// Create and register a store, sharing state
defStore('userStore', (ctx) => {
    const {
        signal,
        computed,
        store,
        inject,
        provide,
        eventBus,
    } = ctx ;
    const name = signal('');
    const age = signal(0);
    const displayName = computed(() => `User: ${name.value}`);

    return {
        name,
        age,
        displayName
    };
});


// Use store in components
defComponent('user-profile', (ctx) => {
    const userStore = ctx.store('userStore');
    
    return () => ctx.html`
        <div>
            <input 
                value=${userStore.name.value} 
                onInput=${(e) => userStore.name.value = e.target.value}
            />
            <div>${userStore.displayName.value}</div>
        </div>
    `;
});

// use as composable, return function
defStore('useUser', (ctx) => ({name, age}) => {
    const name = ctx.signal(name);
    const age = ctx.signal(age);
    const displayName = ctx.computed(() => `User: ${name.value}`);

    return {
        name,
        age,
        displayName
    };
});
const user = ctx.store('useUser')({ name: 'Alex', age: 20 });
</script></code></pre>

        <h2 id="eventbus">EventBus</h2>
        <pre><code class="language-javascript"><script type="text/plain">
const { eventBus } = ctx;

effect(()=>{
    const unsubscribe = eventBus.on('my-event:update', (payload)=> { console.log(payoload) });
    return unsubscribe;
})
eventBus.emit('my-event:update', {value: 1});
/// Use this event for init out side library, at this moment all html was rendered
eventBus.on('components:ready', ()=> { console.log('all component was mounted and ready') });
```
</script></code></pre>

        <h2 id="di">Provide / Inject</h2>
        <pre><code class="language-javascript"><script type="text/plain">
provide('api', {
    getItems: () => [1, 2, 3]
});

const api = inject('api');
api.getItems();
</script></code></pre>

        <h2 id="routing">Роутинг</h2>
        <pre><code class="language-javascript"><script type="text/plain">
defComponent("app-root", ({ html, createRouter, provide, signal }) => {
    const router = createRouter([
        { name: "home", path: "/", render: () => html`<h1>Home</h1>` },
        { name: "user", path: "/users/:id", render: ({ id }) => html`<h1>User ${id}</h1>` },
        { name: "about", path: "/about", render: () => html`<h1>About</h1>` },
        { name: "notfound", path: "*", render: () => html`<h1>404 Not Found</h1>` }
    ]);

    provide('router', router);

    const params = signal({ id: '1' });

    return () => html`
        <header>
            <h2>My App</h2>
            <nav>
                <route-link .to=${`home`}><button>Home</button></route-link>
                <route-link .to=${`about`}><button>About</button></route-link>
                <route-link .to=${`user`} .params=${{ id: 123 }}>
                    <button>User 123</button>
                </route-link>
            </nav>
        </header>

        <main>
            ${router.view()}
        </main>
    `;
});


defComponent("route-link", ({ prop, html, slot, $this, inject, effect }) => {
    const to = prop("to", { type: String });
    const params = prop("params", { type: Object, default: {} });

    const router = inject('router');

    effect(() => {
        const route = router.route(to.value, params.value);
        $this.setAttribute('href', route ?? '#');
    });


    $this.onclick = (e) => {
        e.preventDefault();
        if (to.value) {
            router.navigate(to.value, params.value);
        }
    }

    return () => html`${slot.default}`;
});
</script></code></pre>

        <h2 id="popup-window">Модальное окно</h2>
        <pre><code class="language-html">
<script type="text/plain">
<!-- Id блока который указан в data-content-id будет в качестве контента для окна -->
<popup-trigger data-content-id="popup-content">
    <button class="btn-accent">Открыть окно</button>
</popup-trigger>
<div style="display:none;height:0" aria-hidden="">
    <div id="popup-content">блок который будет в качестве контента для окна </div>
</div>
<!-- Открыть в popup компонент и передать в этот компонент параметры-->
<popup-trigger data-component="my-user" data-user-id="1">
    Открыть компонент my-user с параметрам user-id
</popup-trigger>

<!-- Расположить в конец body -->
<popup-window></popup-window>
</script>
</code></pre>

        <pre><code class="language-javascript">// Программное открытие 
const options = {
    title
    body
    content
    autoClose // Время в милисек автозакрытия окна
    onClose
} 
//Открыть глобально 
document.querySelector('popup-window', ).open({ title: 'title' })
// Через event bus внутри компонентов
eventBus.emit('popup:open', { title: 'title' });
eventBus.emit('popup:close'); 
<script type="text/plain">
defComponent('eventbus-open', ({ html, eventBus }) => {
    const userId = "22";
    const open = () => {
        eventBus.emit('popup:open', { content: () => html`<my-user .userId=${userId}></my-user>` })
    }
    return () => html`<button class="btn-accent" onclick=${open}>Открыть через eventubs</button>`
})
</script>
</code></pre>
        <p>
            <popup-trigger data-content-id="popup-content">
                <button class="btn-accent">Открыть окно с указанием блока по id с конентом</button>
            </popup-trigger>
        </p>

        <p>
        <div style="display:none;height:0" aria-hidden="">
            <div id="popup-content">блок c контеном</div>
        </div>
        </p>
        <p>
            <popup-trigger data-component="my-user" data-user-id="1">
                <button class="btn-accent"> Открыть компонент с параметрами</button>
            </popup-trigger>
        </p>
        <p>
            <eventbus-open></eventbus-open>
        </p>
        <script>
            defComponent('my-user', ({ html, prop }) => {
                const userId = prop('userId');
                return () => html`userId: ${userId.value}`
            });
            defComponent('eventbus-open', ({ html, eventBus }) => {
                const userId = "22";
                const open = () => {
                    eventBus.emit('popup:open', { content: () => html`<my-user .userId=${userId}></my-user>` })
                }
                return () => html`<button class="btn-accent" onclick=${open}>Открыть через eventubs</button>`
            })
        </script>
        <p>
        <div>
            <button class="btn-accent" onclick="document.querySelector('popup-window', )?.open({ title: 'title' })">
                Открыть глобально
            </button>
        </div>
        </p>

        <popup-window></popup-window>

        <h2 id="nav-drawer" class="text-2xl font-semibold mt-10">Navigation drawer</h2>
        <pre><code class="language-html"><script type="text/plain">
<toggle-drawer></toggle-drawer>
<nav-drawer>
    <ul>
        <li><a href="#">Главная</a></li>
        <li><a href="#">О нас</a></li>
        <li><a href="#">Услуги</a></li>
        <li><a href="#">Контакты</a></li>
    </ul>
</nav-drawer>
<!--Глобавльный доступ к состоянию-->
document.querySelector('nav-drawer')?.drawer 
</script>
</code></pre>

        <div data-theme="dark">
            <toggle-drawer></toggle-drawer>
            <div class="margin-line">
                <button class=" btn-accent" onclick="document.querySelector('nav-drawer')?.drawer.toggle()">Открыть
                    через
                    глобальную функцию
                </button>
            </div>
            <nav-drawer>
                <ul>
                    <li><a href="#">Главная</a></li>
                    <li><a href="#">О нас</a></li>
                    <li><a href="#">Услуги</a></li>
                    <li><a href="#">Контакты</a></li>
                </ul>
            </nav-drawer>
        </div>

        <h2 id="grid" class="text-2xl font-semibold mt-10">Пример сетки</h2>
        <p>Ты можешь делать колонки с помощью классов <code>.row</code> и <code>.col-*</code>.</p>

        <div class="row" style="margin-top:20px;">
            <div class="col col-6">
                <div class="box">Колонка 50%</div>
            </div>
            <div class="col col-6">
                <div class="box">Колонка 50%</div>
            </div>
        </div>

        <div class="row" style="margin-top:20px;">
            <div class="col col-4">
                <div class="box">33%</div>
            </div>
            <div class="col col-4">
                <div class="box">33%</div>
            </div>
            <div class="col col-4">
                <div class="box">33%</div>
            </div>
        </div>

        <div class="row" style="margin-top:20px;">
            <div class="col col-3">
                <div class="box">25%</div>
            </div>
            <div class="col col-3">
                <div class="box">25%</div>
            </div>
            <div class="col col-3">
                <div class="box">25%</div>
            </div>
            <div class="col col-3">
                <div class="box">25%</div>
            </div>
        </div>

    </main>

</body>

</html>