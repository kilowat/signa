<!DOCTYPE html>
<html>

<head>
    <title>UI Components Demo</title>
    <link href="styles.css" rel="stylesheet" />
    <script src="../dist/signa.min.js"></script>
</head>

<body>
    <script>
        const { defComponent, defStore, eventBus } = window.signa;

        eventBus.on('counter:changed', (payload) => {
            console.log(payload);
        })

        eventBus.emit('counter:changed', { value: 1 });

        defStore('counterStore', ({ signal }) => {
            const count = signal(0);
            const inc = () => count.value++;
            return {
                count,
                inc,
            }
        })

        defComponent('counter-component', (ctx) => {
            const {
                $this,
                signal,
                effect,
                computed,
                html,
                prop,
                slot,
                render,
                store
            } = ctx;
            const header = slot('header');
            const footer = slot('footer');

            //Current created root dom element
            console.log($this)
            // Props
            const initialValue = prop({
                name: 'initial-value',
                type: Number,
                default: 0
            });

            const boolProp = prop({
                name: 'bool-value',
                type: Boolean,
                default: false
            });

            const arrayProp = prop({
                name: 'array-value',
                type: Array,
                default: []
            });

            const objectProp = prop({
                name: 'object-value',
                type: Object,
                default: null
            });


            const count = signal(initialValue.value);
            const counterStore = store('counterStore');

            effect(() => {
                return () => console.log('unmount');
            })

            effect(() => {
                console.log("Whatch value " + count);
            })

            return () => html`
                <div>
                    <div>${header}</div>
                    <div>${slot.default}</div>
                    <div>${footer}</div>
                </div>
                <div>
                    <div>bool prop: ${boolProp.value}</div>
                    <div>array prop: ${JSON.stringify(arrayProp.value)}</div>
                    <div>object prop: ${JSON.stringify(objectProp.value)}</div>
                </div>
                <div>
                    Count: ${count.value}
                    <button onclick=${() => count.value++}>Increment</button>
                </div>
                <div>
                    CountStore: ${counterStore.count.value}
                    <button onclick=${() => counterStore.inc()}>Increment</button>
                </div>
            `;
        });

        defComponent('parent-component', ({ signal, html }) => {
            const count = signal(10);
            return () => html`
        <div>
            <div>Parent: ${count.value}</div>
            <button onclick=${() => count.value++}>+</button>
            <child-component .count=${count}></child-component>
        </div>`;
        });

        defComponent('child-component', ({ prop, html }) => {
            const count = prop({ name: 'count', type: Array, default: 0 });
            return () => html`<div>Child: ${count.value}</div>`;
        });
    </script>
    <h1>Component Examples</h1>
    <counter-component data-initial-value="4" data-array-value="[1,2,3]" data-object-value='{"a":1}'>
        <div data-slot="header"><b>Header content</b></div>
        <b>default slot</b>
        <div data-slot="footer">Footer content</div>
    </counter-component>
    <parent-component></parent-component>
</body>


</html>