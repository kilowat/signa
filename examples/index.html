<!DOCTYPE html>
<html>

<head>
    <title>UI Components Demo</title>
    <link href="styles.css" rel="stylesheet" />
    <script src="../packages/core/dist/signa.core.min.js"></script>
    <script src="../packages/components/dist/signa.components.min.js"></script>
</head>

<body>
    <script>
        const { def, computed, signal, app, html } = window.signa;
        const _news = [];
        /**
         * @typedef {Object} MyApi
         * @property {() => Promise<{ id: number }[]>} fetchNews - Функция для получения новостей
         */
        /** @type {MyApi} */
        const myApi = {
            fetchNews: async () => new Promise((resolve) => {
                const newItem = { id: _news.length + 1, name: 'name' + _news.length + 1 }
                setTimeout(() => {
                    _news.push(newItem)
                    resolve(_news)
                }, 100)
            })
        }

        // Это сервис патерн сервис локатор  можно ложить любой обьект потом достать поддержка lazy и разруливание зависимостей
        app.register('api', () => myApi);

        def({
            tagName: 'my-button',
            slots: ['header', 'footer'],
            props: {
                name: {
                    type: String,
                    default: 'test'
                }
            },
            setup({ props }) {
                /** @type {MyApi} */
                const api = app.get('api');

                const count = signal(0);
                const news = signal({ items: [], isLoading: false });

                const newsDebug = computed(() => JSON.stringify(news.value));
                const isDouble = computed(() => count.value % 2 === 0);

                const fetchNews = async () => {
                    news.valueCopy({ isLoading: true })
                    const items = await api.fetchNews()
                    news.valueCopy({ isLoading: false, items })
                }

                const inc = () => count.value++;

                return {
                    app,
                    count,
                    inc,
                    isDouble,
                    fetchNews,
                    news,
                    newsDebug
                }
            },
            connected() {
                console.log('connected:');
                console.log(this.inc, this.fetchNews, this.count.value, this.isDouble.value, this.app);

            },
            disconnected() {
                console.log('disconnected');
                console.log(this.inc, this.fetchNews, this.count.value, this.isDouble.value, this.app);
            },
            render() {
                return html`
                    <div>
                        <div>${this.newsDebug.value}</div>
                        <div><button @click=${this.fetchNews}>fetch news</button></div>
                        <div>IsDouble: ${this.isDouble.value}</div>
                        <div>Header slot result: ${this.slots.header}</div>
                        <div>${this.count.value}</div>
                        <div>Default slot result: ${this.slots.default}</div>
                        <div>Footer slot result: ${this.slots.footer}</div>
                        <div><button @click="${this.inc}">inc</button></div>
                        <prop-example-tag data-example="${this.count.value}"></prop-example-tag>
                    </div>`;
            }
        });

        def({
            tagName: 'prop-example-tag',
            props: {
                example: {
                    type: Number,
                    default: 0
                }
            },
            render() {
                return html`prop: ${this.example.value}`
            },
        })
    </script>
    <h1>Component Examples</h1>
    <my-button>
        <div data-slot="header">Header content</div>
        Default content
        <div data-slot="footer">Footer content</div>
    </my-button>
    <signa-button></signa-button>
    <smart-filter></smart-filter>
    <filter-panel></filter-panel>
</body>


</html>